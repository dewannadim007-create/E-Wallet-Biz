<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta id="searchTermMeta" name="searchTerm" th:content="${searchTerm}" th:if="${searchTerm}">
    <title>Locations - E-Wallet Biz</title>
    <link rel="stylesheet" href="/css/modern-banking.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>

<body>
    <div class="dashboard-container" style="flex-direction: column; background: var(--bg-color);">

        <!-- Header Section -->
        <header class="page-header m-0">
            <div class="header-wrapper">
                <div>
                    <h2 class="m-0" style="font-size: 1.75rem;"><i class="fas fa-map-marked-alt"></i> Find Locations
                    </h2>
                    <p style="margin: 5px 0 0; opacity: 0.9;">Locate the nearest Branch or ATM</p>
                </div>
                <a href="/first" class="btn back-btn-glass">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </header>

        <section class="page-content locations-content">

            <!-- Search & Filter -->
            <div class="section-card search-card">
                <form action="/branch/search" method="get" class="search-form">
                    <div class="search-input-group">
                        <span class="input-group-text"><i class="fas fa-search"
                                style="color: var(--text-secondary);"></i></span>
                        <input type="text" name="search" class="search-input-field"
                            placeholder="Search by city, area, or branch name..." th:value="${searchTerm}">
                    </div>
                    <button type="submit" class="btn btn-primary" style="padding: 0.8rem 1.5rem;">
                        <i class="fas fa-filter"></i> Find
                    </button>
                    <a href="/branch" class="btn btn-secondary" style="padding: 0.8rem 1.5rem;" th:if="${searchTerm}">
                        <i class="fas fa-undo"></i> Reset
                    </a>
                </form>
            </div>

            <!-- Map Section -->
            <div class="map-container" th:if="${not #lists.isEmpty(branches)}">
                <div id="map-loading" class="map-loading"><i class="fas fa-sync fa-spin"></i> Locating addresses...
                </div>
                <div id="map"></div>
            </div>

            <!-- Locations Grid -->
            <div class="card-grid" th:if="${not #lists.isEmpty(branches)}">
                <div class="location-card" th:each="branch : ${branches}" th:id="'card-' + ${branch.id}"
                    th:data-lat="${branch.latitude != null ? branch.latitude : 0}"
                    th:data-lng="${branch.longitude != null ? branch.longitude : 0}" th:data-name="${branch.name}"
                    th:data-type="${branch.type}" th:data-location="${branch.location}">

                    <div class="location-type-badge">
                        <span class="badge" th:classappend="${branch.type == 'ATM'} ? 'info' : 'success'">
                            <i class="fas"
                                th:classappend="${branch.type == 'ATM'} ? 'fa-money-bill-wave' : 'fa-building'"></i>
                            <span th:text="${branch.type}">Type</span>
                        </span>
                    </div>

                    <div class="card-image-header">
                        <img th:src="@{/images/atm.png}" th:if="${branch.type == 'ATM'}" alt="ATM Location">
                        <img th:src="@{/images/branch.png}" th:unless="${branch.type == 'ATM'}" alt="Branch Location">
                    </div>

                    <div class="card-content">
                        <div>
                            <h3 th:text="${branch.name}"
                                style="margin: 0 0 0.5rem; color: var(--primary-color); font-size: 1.25rem;">Branch Name
                            </h3>

                            <p class="muted-text" style="font-size: 0.95rem; line-height: 1.5; margin-bottom: 1.5rem;">
                                <i class="fas fa-location-arrow"
                                    style="color: var(--primary-light); margin-right: 8px;"></i>
                                <span th:text="${branch.location}">Address Details Here</span>
                            </p>
                        </div>

                        <button class="btn btn-primary"
                            style="width: 100%; background: transparent; color: var(--primary-color); border: 1px solid var(--primary-color); margin-top: auto;"
                            th:data-address="${branch.location}" onclick="window.openDirections(this.dataset.address)">
                            <i class="fas fa-directions"></i> Get Directions
                        </button>
                    </div>
                </div>
            </div>

            <!-- No Results State -->
            <div th:if="${#lists.isEmpty(branches)}" class="no-results-box">
                <div class="no-results-icon">
                    <i class="fas fa-search-location" style="font-size: 2.5rem;"></i>
                </div>
                <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">No locations found</h3>
                <p class="muted-text" style="max-width: 400px; margin: 0 auto 1.5rem;">We couldn't find any branches or
                    ATMs matching your search criteria. Try a different search term or view all locations.</p>
                <a href="/branch" class="btn btn-primary">View All Locations</a>
            </div>

        </section>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="/js/branch-locator.js"></script>
</body>

</html>